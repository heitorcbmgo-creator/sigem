{% extends 'base.html' %}
{% load static %}

{% block title %}Comparar Oficiais{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i data-lucide="git-compare"></i>
        Comparar Oficiais
    </h1>
    <p class="page-subtitle">Selecione oficiais para comparar a carga de trabalho em missões ativas</p>
</div>

<div class="comparar-layout">
    <!-- Coluna Esquerda: Lista de Seleção -->
    <div class="comparar-lista">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="list-checks"></i>
                    Selecione os Oficiais
                </h2>
                <span class="badge badge-info" id="contador-selecionados">0 selecionados</span>
            </div>
            <div class="card-body" style="padding: 0;">
                <div id="lista-oficiais" 
                     hx-get="{% url 'htmx_oficiais_selecao' %}" 
                     hx-trigger="load">
                    <p class="text-gray text-center py-4">Carregando oficiais...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Coluna Direita: Cards de Comparação -->
    <div class="comparar-cards">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="bar-chart-3"></i>
                    Comparação de Carga de Trabalho
                </h2>
            </div>
            <div class="card-body">
                <div id="cards-comparacao">
                    <div class="text-center text-muted py-4">
                        <i data-lucide="mouse-pointer-click" style="width:48px;height:48px;opacity:0.3;display:block;margin:0 auto 1rem;"></i>
                        <p>Selecione oficiais na lista ao lado.</p>
                        <p class="text-sm">Os cards serão atualizados automaticamente.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Legenda -->
        <div class="comparar-legenda">
            <div class="legenda-item">
                <span class="legenda-cor baixa"></span>
                <span>Complexidade Baixa (peso 1)</span>
            </div>
            <div class="legenda-item">
                <span class="legenda-cor media"></span>
                <span>Complexidade Média (peso 2)</span>
            </div>
            <div class="legenda-item">
                <span class="legenda-cor alta"></span>
                <span>Complexidade Alta (peso 3)</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.comparar-layout {
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 1.5rem;
    align-items: start;
}

.comparar-lista .card-body {
    max-height: 600px;
    overflow-y: auto;
}

.comparar-cards {
    min-height: 400px;
}

.comparar-legenda {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.legenda-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: #6b7280;
}

.legenda-cor {
    width: 16px;
    height: 16px;
    border-radius: 4px;
}

.legenda-cor.baixa { background: #16a34a; }
.legenda-cor.media { background: #eab308; }
.legenda-cor.alta { background: #dc2626; }

@media (max-width: 1024px) {
    .comparar-layout {
        grid-template-columns: 1fr;
    }
    
    .comparar-lista .card-body {
        max-height: 350px;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function atualizarCards() {
    const checkboxes = document.querySelectorAll('.oficial-checkbox:checked');
    const ids = Array.from(checkboxes).map(cb => cb.value).join(',');
    
    // Atualizar contador
    document.getElementById('contador-selecionados').textContent = checkboxes.length + ' selecionados';
    
    // Carregar cards
    if (ids) {
        htmx.ajax('GET', '{% url "htmx_oficiais_cards" %}?ids=' + ids, '#cards-comparacao');
    } else {
        document.getElementById('cards-comparacao').innerHTML = `
            <div class="text-center text-muted py-4">
                <i data-lucide="mouse-pointer-click" style="width:48px;height:48px;opacity:0.3;display:block;margin:0 auto 1rem;"></i>
                <p>Selecione oficiais na lista ao lado.</p>
                <p class="text-sm">Os cards serão atualizados automaticamente.</p>
            </div>
        `;
        lucide.createIcons();
    }
}

// Recarregar ícones após HTMX swap
document.body.addEventListener('htmx:afterSwap', function(evt) {
    lucide.createIcons();
});
</script>
{% endblock %}
{% extends 'base.html' %}
{% load static %}

{% block title %}Vis√£o Geral{% if is_comandante %} - {{ obm_sigla }}{% endif %}{% endblock %}

{% block content %}
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<div class="page-header">
    <h1 class="page-title">
        <i data-lucide="layout-dashboard"></i>
        Vis√£o Geral{% if is_comandante %} - {{ obm_sigla }}{% endif %}
    </h1>
    <p class="page-subtitle">
        {% if is_comandante %}
        Dashboard Executivo - {{ obm_sigla }} e Unidades Subordinadas
        {% else %}
        Dashboard Executivo - Comando-Geral CBMGO
        {% endif %}
    </p>
</div>

<!-- ============================================================
     KPIs PRINCIPAIS
     ============================================================ -->
<div class="kpi-grid">
    <div class="kpi-card">
        <button class="kpi-info-btn" type="button">
            <i data-lucide="info"></i>
        </button>
        <div class="kpi-tooltip">
            <strong>Oficiais Ativos</strong><br>
            Total de oficiais cadastrados com status ativo no sistema.
            {% if is_comandante %}Filtrado para sua OBM e subordinadas.{% endif %}
        </div>
        <div class="kpi-icon kpi-icon-blue">
            <i data-lucide="users"></i>
        </div>
        <div class="kpi-content">
            <span class="kpi-value">{{ total_oficiais }}</span>
            <span class="kpi-label">Oficiais Ativos</span>
        </div>
    </div>
    
    <div class="kpi-card">
        <button class="kpi-info-btn" type="button">
            <i data-lucide="info"></i>
        </button>
        <div class="kpi-tooltip">
            <strong>Miss√µes Ativas</strong><br>
            Quantidade de miss√µes com status "Em Andamento".
            {% if is_comandante %}Considera apenas miss√µes onde h√° oficiais da sua OBM designados.{% endif %}
        </div>
        <div class="kpi-icon kpi-icon-green">
            <i data-lucide="briefcase"></i>
        </div>
        <div class="kpi-content">
            <span class="kpi-value">{{ total_missoes_ativas }}</span>
            <span class="kpi-label">Miss√µes Ativas</span>
        </div>
    </div>
    
    <div class="kpi-card">
        <button class="kpi-info-btn" type="button">
            <i data-lucide="info"></i>
        </button>
        <div class="kpi-tooltip">
            <strong>Taxa de Ocupa√ß√£o</strong><br>
            Percentual de oficiais que possuem pelo menos uma miss√£o ativa.<br>
            <span style="font-family:monospace;font-size:0.75rem;background:rgba(255,255,255,0.1);padding:2px 4px;border-radius:3px;">
                (Oficiais com miss√£o √∑ Total) √ó 100
            </span><br>
            <span style="font-size:0.7rem;color:#9ca3af;">Meta ideal: 70% a 85%</span>
        </div>
        <div class="kpi-icon {% if taxa_ocupacao >= 70 and taxa_ocupacao <= 85 %}kpi-icon-green{% elif taxa_ocupacao > 85 or taxa_ocupacao < 50 %}kpi-icon-red{% else %}kpi-icon-yellow{% endif %}">
            <i data-lucide="activity"></i>
        </div>
        <div class="kpi-content">
            <span class="kpi-value">{{ taxa_ocupacao }}%</span>
            <span class="kpi-label">Taxa de Ocupa√ß√£o</span>
        </div>
        <div class="kpi-meta">Meta: 70-85%</div>
    </div>
    
    <div class="kpi-card">
        <button class="kpi-info-btn" type="button">
            <i data-lucide="info"></i>
        </button>
        <div class="kpi-tooltip">
            <strong>Carga M√©dia</strong><br>
            M√©dia de miss√µes por oficial (considerando apenas os que t√™m miss√£o ativa).<br>
            <span style="font-family:monospace;font-size:0.75rem;background:rgba(255,255,255,0.1);padding:2px 4px;border-radius:3px;">
                Total designa√ß√µes √∑ Oficiais com miss√£o
            </span>
        </div>
        <div class="kpi-icon kpi-icon-purple">
            <i data-lucide="layers"></i>
        </div>
        <div class="kpi-content">
            <span class="kpi-value">{{ carga_media }}</span>
            <span class="kpi-label">Carga M√©dia</span>
        </div>
        <div class="kpi-meta">Miss√µes/Oficial</div>
    </div>
    
    <div class="kpi-card">
        <button class="kpi-info-btn" type="button">
            <i data-lucide="info"></i>
        </button>
        <div class="kpi-tooltip">
            <strong>Alta Complexidade</strong><br>
            Percentual de designa√ß√µes ativas classificadas como alta complexidade.<br>
            <span style="font-family:monospace;font-size:0.75rem;background:rgba(255,255,255,0.1);padding:2px 4px;border-radius:3px;">
                (Designa√ß√µes alta √∑ Total designa√ß√µes) √ó 100
            </span><br>
            <span style="font-size:0.7rem;color:#9ca3af;">Meta: manter abaixo de 25%</span>
        </div>
        <div class="kpi-icon {% if indice_alta <= 25 %}kpi-icon-green{% elif indice_alta <= 35 %}kpi-icon-yellow{% else %}kpi-icon-red{% endif %}">
            <i data-lucide="flame"></i>
        </div>
        <div class="kpi-content">
            <span class="kpi-value">{{ indice_alta }}%</span>
            <span class="kpi-label">Alta Complexidade</span>
        </div>
        <div class="kpi-meta">Meta: &lt;25%</div>
    </div>
    
    {% if not is_comandante %}
    <div class="kpi-card">
        <button class="kpi-info-btn" type="button">
            <i data-lucide="info"></i>
        </button>
        <div class="kpi-tooltip">
            <strong>Solicita√ß√µes Pendentes</strong><br>
            Quantidade de solicita√ß√µes de designa√ß√£o aguardando an√°lise pela BM/3.
        </div>
        <div class="kpi-icon {% if solicitacoes_pendentes == 0 %}kpi-icon-green{% elif solicitacoes_pendentes <= 5 %}kpi-icon-yellow{% else %}kpi-icon-red{% endif %}">
            <i data-lucide="inbox"></i>
        </div>
        <div class="kpi-content">
            <span class="kpi-value">{{ solicitacoes_pendentes }}</span>
            <span class="kpi-label">Solicita√ß√µes Pendentes</span>
        </div>
    </div>
    {% endif %}
</div>

<!-- ============================================================
     NAVEGA√á√ÉO POR ABAS
     ============================================================ -->
<div class="dashboard-tabs">
    <button class="tab-btn active" data-tab="visao-geral">
        <i data-lucide="bar-chart-3"></i>
        Vis√£o Geral
    </button>
    <button class="tab-btn" data-tab="por-obm">
        <i data-lucide="building-2"></i>
        Por OBM
    </button>
    <button class="tab-btn" data-tab="por-posto">
        <i data-lucide="medal"></i>
        Por Posto
    </button>
    <button class="tab-btn" data-tab="alertas">
        <i data-lucide="alert-triangle"></i>
        Alertas
        {% if alertas %}<span class="tab-badge">{{ alertas|length }}</span>{% endif %}
    </button>
</div>

<!-- ============================================================
     ABA: VIS√ÉO GERAL
     ============================================================ -->
<div class="tab-content active" id="tab-visao-geral">
    <div class="dashboard-grid">
        <!-- Evolu√ß√£o Mensal -->
        <div class="card card-chart">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="trending-up"></i>
                    Evolu√ß√£o de Miss√µes (12 meses)
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üìà Evolu√ß√£o de Miss√µes</div>
                        <div class="info-tooltip-text">
                            Mostra a quantidade de miss√µes criadas, em andamento e conclu√≠das m√™s a m√™s nos √∫ltimos 12 meses.
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Objetivo:</strong> Identificar tend√™ncias e sazonalidade na cria√ß√£o e conclus√£o de miss√µes.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <canvas id="chartEvolucao" height="280"></canvas>
            </div>
        </div>
        
        <!-- Miss√µes por Tipo -->
        <div class="card card-chart">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="pie-chart"></i>
                    Miss√µes Ativas por Tipo
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">ü•ß Miss√µes por Tipo</div>
                        <div class="info-tooltip-text">
                            Distribui√ß√£o das miss√µes ativas por categoria: Operacional, Administrativa, Ensino, Correicional, Comiss√£o e A√ß√£o Social.
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Objetivo:</strong> Visualizar onde est√£o concentrados os esfor√ßos da corpora√ß√£o.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body chart-donut-container">
                <canvas id="chartTipo" height="280"></canvas>
            </div>
        </div>
        
        <!-- Oficiais sob Maior Demanda -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="alert-circle"></i>
                    Oficiais sob Maior Demanda
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">‚ö†Ô∏è Monitoramento de Carga</div>
                        <div class="info-tooltip-text">
                            Acompanhamento dos oficiais com maior carga de trabalho ponderada em miss√µes ativas.
                        </div>
                        <div class="info-tooltip-calc">
                            Carga = (Baixa√ó1) + (M√©dia√ó2) + (Alta√ó3)
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Status:</strong><br>
                            üî¥ Cr√≠tico: carga &gt; 20<br>
                            üü† Alto: carga 15-20<br>
                            üü° Moderado: carga 10-14<br>
                            üü¢ Normal: carga &lt; 10
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table class="table-ranking">
                        <thead style="position: sticky; top: 0; background: white; z-index: 1;">
                            <tr>
                                <th style="width: 30px;"></th>
                                <th>Oficial</th>
                                <th>OBM</th>
                                <th class="text-center">Miss√µes</th>
                                <th class="text-center">Carga</th>
                                <th class="text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for o in oficiais_top %}
                            <tr>
                                <td class="text-center text-muted" style="font-size: 0.75rem;">
                                    {% if o.carga_ponderada > 20 %}üî¥{% elif o.carga_ponderada > 14 %}üü†{% elif o.carga_ponderada > 9 %}üü°{% else %}üü¢{% endif %}
                                </td>
                                <td>
                                    <div class="oficial-cell">
                                        <img src="{{ o.foto_url }}" alt="" class="oficial-mini-foto">
                                        <span>{{ o.posto }} {{ o.nome_guerra|default:o.nome }}</span>
                                    </div>
                                </td>
                                <td class="text-muted">{{ o.obm|default:"-"|truncatechars:12 }}</td>
                                <td class="text-center">
                                    <span class="badge badge-info">{{ o.total_missoes }}</span>
                                </td>
                                <td class="text-center">
                                    <span class="badge {% if o.carga_ponderada > 20 %}badge-danger{% elif o.carga_ponderada > 14 %}badge-warning{% elif o.carga_ponderada > 9 %}badge-yellow{% else %}badge-success{% endif %}">
                                        {{ o.carga_ponderada }}
                                    </span>
                                </td>
                                <td class="text-center" style="font-size: 0.75rem;">
                                    {% if o.carga_ponderada > 20 %}<span class="text-danger">Cr√≠tico</span>
                                    {% elif o.carga_ponderada > 14 %}<span class="text-warning">Alto</span>
                                    {% elif o.carga_ponderada > 9 %}<span style="color: #ca8a04;">Moderado</span>
                                    {% else %}<span class="text-success">Normal</span>{% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-muted">Nenhum oficial com miss√£o ativa</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Miss√µes Recentes -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="clock"></i>
                    Miss√µes Recentes
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üïê Miss√µes Recentes</div>
                        <div class="info-tooltip-text">
                            √öltimas 5 miss√µes cadastradas no sistema, ordenadas pela data de cria√ß√£o (mais recentes primeiro).
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Objetivo:</strong> Acompanhar as novas demandas que est√£o chegando.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Miss√£o</th>
                                <th>Tipo</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Designados</th>
                                <th>Criada em</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for m in missoes_recentes %}
                            <tr>
                                <td><strong>{{ m.nome|truncatechars:35 }}</strong></td>
                                <td>{{ m.get_tipo_display }}</td>
                                <td class="text-center">
                                    <span class="badge badge-{% if m.status == 'EM_ANDAMENTO' %}success{% elif m.status == 'PLANEJADA' %}info{% elif m.status == 'CONCLUIDA' %}purple{% else %}danger{% endif %}">
                                        {{ m.get_status_display }}
                                    </span>
                                </td>
                                <td class="text-center">{{ m.qtd_designados }}</td>
                                <td class="text-muted">{{ m.criado_em|date:"d/m/Y" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center text-muted">Nenhuma miss√£o cadastrada</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ============================================================
     ABA: POR OBM
     ============================================================ -->
<div class="tab-content" id="tab-por-obm">
    <div class="dashboard-grid">
        <!-- Gr√°fico Carga por OBM -->
        <div class="card card-chart card-full-width">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="bar-chart-horizontal"></i>
                    Carga de Trabalho por OBM
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üìä Carga por OBM</div>
                        <div class="info-tooltip-text">
                            Gr√°fico de barras empilhadas mostrando a distribui√ß√£o de designa√ß√µes por complexidade em cada OBM.
                        </div>
                        <div class="info-tooltip-calc">
                            üü¢ Baixa (peso 1) | üü° M√©dia (peso 2) | üî¥ Alta (peso 3)
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Objetivo:</strong> Comparar a carga entre unidades e identificar desequil√≠brios.
                        </div>
                    </div>
                </div>
                <div class="card-legend">
                    <span class="legend-item"><span class="legend-color" style="background:#22c55e;"></span> Baixa</span>
                    <span class="legend-item"><span class="legend-color" style="background:#eab308;"></span> M√©dia</span>
                    <span class="legend-item"><span class="legend-color" style="background:#ef4444;"></span> Alta</span>
                </div>
            </div>
            <div class="card-body">
                <canvas id="chartOBM" height="350"></canvas>
            </div>
        </div>
        
        <!-- Tabela detalhada por OBM -->
        <div class="card card-full-width">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="table"></i>
                    Detalhamento por OBM
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üìã Detalhamento por OBM</div>
                        <div class="info-tooltip-text">
                            Tabela com m√©tricas detalhadas de cada OBM: efetivo, oficiais em miss√£o, dispon√≠veis e carga por complexidade.
                        </div>
                        <div class="info-tooltip-calc">
                            Carga Total = (Baixa√ó1) + (M√©dia√ó2) + (Alta√ó3)<br>
                            Ocupa√ß√£o = (Em Miss√£o √∑ Efetivo) √ó 100
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Cores da ocupa√ß√£o:</strong> üü¢ 70-85% ideal | üü° &lt;70% baixo | üî¥ &gt;90% cr√≠tico
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>OBM</th>
                                <th class="text-center">Efetivo</th>
                                <th class="text-center">Em Miss√£o</th>
                                <th class="text-center">Dispon√≠vel</th>
                                <th class="text-center">Baixa</th>
                                <th class="text-center">M√©dia</th>
                                <th class="text-center">Alta</th>
                                <th class="text-center">Carga Total</th>
                                <th class="text-center">Ocupa√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for obm in carga_por_obm %}
                            <tr>
                                <td><strong>{{ obm.obm }}</strong></td>
                                <td class="text-center">{{ obm.efetivo }}</td>
                                <td class="text-center">{{ obm.em_missao }}</td>
                                <td class="text-center">{{ obm.disponivel }}</td>
                                <td class="text-center"><span class="badge badge-success">{{ obm.baixa }}</span></td>
                                <td class="text-center"><span class="badge badge-warning">{{ obm.media }}</span></td>
                                <td class="text-center"><span class="badge badge-danger">{{ obm.alta }}</span></td>
                                <td class="text-center"><strong>{{ obm.carga_total }}</strong></td>
                                <td class="text-center">
                                    <div class="ocupacao-bar">
                                        <div class="ocupacao-fill {% if obm.ocupacao > 90 %}ocupacao-critico{% elif obm.ocupacao > 85 %}ocupacao-alto{% elif obm.ocupacao >= 70 %}ocupacao-ideal{% else %}ocupacao-baixo{% endif %}" style="width: {{ obm.ocupacao }}%;"></div>
                                        <span class="ocupacao-label">{{ obm.ocupacao|floatformat:0 }}%</span>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="9" class="text-center text-muted">Nenhum dado dispon√≠vel</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ============================================================
     ABA: POR POSTO
     ============================================================ -->
<div class="tab-content" id="tab-por-posto">
    <div class="dashboard-grid">
        <!-- Gr√°fico Distribui√ß√£o por Posto -->
        <div class="card card-chart">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="bar-chart-2"></i>
                    Distribui√ß√£o por Posto
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üëî Distribui√ß√£o por Posto</div>
                        <div class="info-tooltip-text">
                            Compara o efetivo total de oficiais com a quantidade em miss√£o, agrupado por posto (Cel, TC, Maj, Cap, etc.).
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Objetivo:</strong> Verificar se a carga est√° proporcional entre os postos.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <canvas id="chartPosto" height="300"></canvas>
            </div>
        </div>
        
        <!-- Gr√°fico Distribui√ß√£o por Quadro -->
        <div class="card card-chart">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="pie-chart"></i>
                    Distribui√ß√£o por Quadro
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üìä Distribui√ß√£o por Quadro</div>
                        <div class="info-tooltip-text">
                            Composi√ß√£o do efetivo por quadro: QOC, QOA/Adm, QOA/M√∫s, QOM/M√©dico, QOM/Dentista.
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Objetivo:</strong> Visualizar a composi√ß√£o do corpo de oficiais por forma√ß√£o/especialidade.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body chart-donut-container">
                <canvas id="chartQuadro" height="300"></canvas>
            </div>
        </div>
        
        <!-- Tabela detalhada por Posto -->
        <div class="card card-full-width">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="table"></i>
                    Detalhamento por Posto
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üìã Detalhamento por Posto</div>
                        <div class="info-tooltip-text">
                            M√©tricas detalhadas por posto: efetivo, em miss√£o, total de designa√ß√µes, carga m√©dia e fun√ß√µes de chefia.
                        </div>
                        <div class="info-tooltip-calc">
                            Carga M√©dia = Total designa√ß√µes √∑ Oficiais em miss√£o<br>
                            % Chefia = Fun√ß√µes chefia √∑ Total designa√ß√µes
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Chefia:</strong> Cmt, SubCmt, Coord, Presidente, Encarregado.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Posto</th>
                                <th class="text-center">Efetivo</th>
                                <th class="text-center">Em Miss√£o</th>
                                <th class="text-center">Total Designa√ß√µes</th>
                                <th class="text-center">Carga M√©dia</th>
                                <th class="text-center">Em Chefia</th>
                                <th class="text-center">% Chefia</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in distribuicao_posto %}
                            <tr>
                                <td><strong>{{ p.posto }}</strong></td>
                                <td class="text-center">{{ p.efetivo }}</td>
                                <td class="text-center">{{ p.em_missao }}</td>
                                <td class="text-center">{{ p.total_designacoes }}</td>
                                <td class="text-center">
                                    <span class="badge {% if p.carga_media > 4 %}badge-warning{% else %}badge-info{% endif %}">
                                        {{ p.carga_media }}
                                    </span>
                                </td>
                                <td class="text-center">{{ p.qtd_chefia }}</td>
                                <td class="text-center">{{ p.perc_chefia|floatformat:0 }}%</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-center text-muted">Nenhum dado dispon√≠vel</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ============================================================
     ABA: ALERTAS
     ============================================================ -->
<div class="tab-content" id="tab-alertas">
    <div class="dashboard-grid">
        <!-- Lista de Alertas -->
        <div class="card card-full-width">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="bell-ring"></i>
                    Alertas do Sistema
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üîî Alertas do Sistema</div>
                        <div class="info-tooltip-text">
                            Notifica√ß√µes autom√°ticas sobre situa√ß√µes que requerem aten√ß√£o: sobrecarga, prazos, pend√™ncias.
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>N√≠veis:</strong><br>
                            üî¥ Cr√≠tico - A√ß√£o imediata<br>
                            üü† Alto - A√ß√£o necess√°ria<br>
                            üü° M√©dio - Acompanhar
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                {% if alertas %}
                <div class="alertas-lista">
                    {% for alerta in alertas %}
                    <div class="alerta-item alerta-{{ alerta.nivel }}">
                        <div class="alerta-icone">
                            <i data-lucide="{{ alerta.icone }}"></i>
                        </div>
                        <div class="alerta-conteudo">
                            <strong>{{ alerta.mensagem }}</strong>
                            <span class="text-muted">{{ alerta.descricao }}</span>
                        </div>
                        <div class="alerta-badge">
                            {% if alerta.nivel == 'critico' %}üî¥ Cr√≠tico
                            {% elif alerta.nivel == 'alto' %}üü† Alto
                            {% elif alerta.nivel == 'medio' %}üü° M√©dio
                            {% else %}‚ö™ Info{% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alertas-vazio">
                    <i data-lucide="check-circle" style="width:48px;height:48px;color:#22c55e;"></i>
                    <h3>Tudo certo!</h3>
                    <p class="text-muted">N√£o h√° alertas no momento.</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Resumo de Status -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="gauge"></i>
                    Indicadores de Sa√∫de
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üìà Indicadores de Sa√∫de</div>
                        <div class="info-tooltip-text">
                            Indicadores visuais do "estado de sa√∫de" da gest√£o de miss√µes.
                        </div>
                        <div class="info-tooltip-meta">
                            <strong>Cores:</strong><br>
                            üü¢ Ideal - Dentro da meta<br>
                            üü° Aten√ß√£o - Pr√≥ximo do limite<br>
                            üî¥ Cr√≠tico - Fora da meta
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="indicadores-lista">
                    <div class="indicador-item">
                        <span class="indicador-label">Taxa de Ocupa√ß√£o</span>
                        <div class="indicador-bar-container">
                            <div class="indicador-bar {% if taxa_ocupacao >= 70 and taxa_ocupacao <= 85 %}indicador-ideal{% elif taxa_ocupacao > 85 %}indicador-alto{% else %}indicador-baixo{% endif %}" style="width: {{ taxa_ocupacao }}%;"></div>
                        </div>
                        <span class="indicador-valor">{{ taxa_ocupacao }}%</span>
                    </div>
                    
                    <div class="indicador-item">
                        <span class="indicador-label">Taxa de Conclus√£o</span>
                        <div class="indicador-bar-container">
                            <div class="indicador-bar {% if taxa_conclusao >= 80 %}indicador-ideal{% elif taxa_conclusao >= 60 %}indicador-medio{% else %}indicador-baixo{% endif %}" style="width: {{ taxa_conclusao }}%;"></div>
                        </div>
                        <span class="indicador-valor">{{ taxa_conclusao }}%</span>
                    </div>
                    
                    <div class="indicador-item">
                        <span class="indicador-label">Complexidade Alta</span>
                        <div class="indicador-bar-container">
                            <div class="indicador-bar {% if indice_alta <= 25 %}indicador-ideal{% elif indice_alta <= 35 %}indicador-medio{% else %}indicador-alto{% endif %}" style="width: {{ indice_alta }}%;"></div>
                        </div>
                        <span class="indicador-valor">{{ indice_alta }}%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- M√©tricas Adicionais -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="info"></i>
                    M√©tricas Adicionais
                </h2>
                <div class="info-container">
                    <button class="info-btn" type="button">
                        <i data-lucide="info"></i>
                    </button>
                    <div class="info-tooltip">
                        <div class="info-tooltip-title">üìä M√©tricas Adicionais</div>
                        <div class="info-tooltip-text">
                            N√∫meros complementares para uma vis√£o mais completa da situa√ß√£o atual.
                        </div>
                        <div class="info-tooltip-meta">
                            Oficiais com e sem miss√£o, miss√µes conclu√≠das, designa√ß√µes por complexidade.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="metricas-grid">
                    <div class="metrica-item">
                        <span class="metrica-valor">{{ oficiais_com_missao }}</span>
                        <span class="metrica-label">Oficiais em Miss√£o</span>
                    </div>
                    <div class="metrica-item">
                        <span class="metrica-valor">{{ oficiais_sem_missao }}</span>
                        <span class="metrica-label">Oficiais Dispon√≠veis</span>
                    </div>
                    <div class="metrica-item">
                        <span class="metrica-valor">{{ total_designacoes_ativas }}</span>
                        <span class="metrica-label">Designa√ß√µes Ativas</span>
                    </div>
                    <div class="metrica-item">
                        <span class="metrica-valor">{{ missoes_concluidas }}</span>
                        <span class="metrica-label">Miss√µes Conclu√≠das</span>
                    </div>
                </div>
                
                <hr style="margin: 1.5rem 0; border-color: var(--sigem-gray-200);">
                
                <h4 style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--sigem-gray-600);">
                    <i data-lucide="layers" style="width:16px;height:16px;vertical-align:middle;"></i>
                    Designa√ß√µes por Complexidade
                </h4>
                <div class="complexidade-bars">
                    <div class="complexidade-item">
                        <span class="complexidade-label">Baixa</span>
                        <div class="complexidade-bar-bg">
                            <div class="complexidade-bar baixa" style="width: {{ perc_baixa }}%;"></div>
                        </div>
                        <span class="complexidade-valor">{{ designacoes_baixa }}</span>
                    </div>
                    <div class="complexidade-item">
                        <span class="complexidade-label">M√©dia</span>
                        <div class="complexidade-bar-bg">
                            <div class="complexidade-bar media" style="width: {{ perc_media }}%;"></div>
                        </div>
                        <span class="complexidade-valor">{{ designacoes_media }}</span>
                    </div>
                    <div class="complexidade-item">
                        <span class="complexidade-label">Alta</span>
                        <div class="complexidade-bar-bg">
                            <div class="complexidade-bar alta" style="width: {{ perc_alta }}%;"></div>
                        </div>
                        <span class="complexidade-valor">{{ designacoes_alta }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ============================================================
     ESTILOS DO DASHBOARD
     ============================================================ -->
<style>
/* KPI Grid */
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.kpi-card {
    background: white;
    border-radius: var(--radius-md);
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--sigem-gray-200);
    position: relative;
}

.kpi-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.kpi-icon svg {
    width: 24px;
    height: 24px;
}

.kpi-icon-blue { background: #dbeafe; color: #2563eb; }
.kpi-icon-green { background: #dcfce7; color: #16a34a; }
.kpi-icon-yellow { background: #fef3c7; color: #d97706; }
.kpi-icon-red { background: #fee2e2; color: #dc2626; }
.kpi-icon-purple { background: #f3e8ff; color: #9333ea; }

.kpi-content {
    display: flex;
    flex-direction: column;
}

.kpi-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--sigem-gray-800);
    line-height: 1;
}

.kpi-label {
    font-size: 0.8rem;
    color: var(--sigem-gray-500);
    margin-top: 0.25rem;
}

.kpi-meta {
    position: absolute;
    bottom: 0.5rem;
    right: 0.75rem;
    font-size: 0.65rem;
    color: var(--sigem-gray-400);
}

/* Tabs */
.dashboard-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    border-bottom: 2px solid var(--sigem-gray-200);
    padding-bottom: 0;
}

.tab-btn {
    padding: 0.75rem 1.25rem;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--sigem-gray-500);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: var(--transition);
}

.tab-btn:hover {
    color: var(--sigem-red);
}

.tab-btn.active {
    color: var(--sigem-red);
    border-bottom-color: var(--sigem-red);
}

.tab-btn svg {
    width: 18px;
    height: 18px;
}

.tab-badge {
    background: var(--sigem-red);
    color: white;
    font-size: 0.7rem;
    padding: 0.15rem 0.5rem;
    border-radius: 10px;
    font-weight: 600;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Dashboard Grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
}

.card-full-width {
    grid-column: 1 / -1;
}

.card-chart {
    min-height: 380px;
}

.chart-donut-container {
    display: flex;
    align-items: center;
    justify-content: center;
}

.card-legend {
    display: flex;
    gap: 1rem;
    font-size: 0.8rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    color: var(--sigem-gray-600);
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}

/* Tabelas */
.table-ranking {
    width: 100%;
}

.ranking-pos {
    width: 40px;
    text-align: center;
    font-weight: 600;
}

.oficial-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.oficial-mini-foto {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
}

/* Ocupa√ß√£o Bar */
.ocupacao-bar {
    width: 100px;
    height: 20px;
    background: var(--sigem-gray-200);
    border-radius: 10px;
    position: relative;
    overflow: hidden;
}

.ocupacao-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 0.3s ease;
}

.ocupacao-critico { background: #ef4444; }
.ocupacao-alto { background: #f97316; }
.ocupacao-ideal { background: #22c55e; }
.ocupacao-baixo { background: #eab308; }

.ocupacao-label {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--sigem-gray-800);
}

/* Alertas */
.alertas-lista {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.alerta-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: var(--radius-md);
    border-left: 4px solid;
}

.alerta-critico {
    background: #fef2f2;
    border-left-color: #ef4444;
}

.alerta-alto {
    background: #fff7ed;
    border-left-color: #f97316;
}

.alerta-medio {
    background: #fefce8;
    border-left-color: #eab308;
}

.alerta-info {
    background: #f0f9ff;
    border-left-color: #3b82f6;
}

.alerta-icone {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.alerta-critico .alerta-icone { background: #fee2e2; color: #dc2626; }
.alerta-alto .alerta-icone { background: #ffedd5; color: #ea580c; }
.alerta-medio .alerta-icone { background: #fef9c3; color: #ca8a04; }
.alerta-info .alerta-icone { background: #dbeafe; color: #2563eb; }

.alerta-icone svg {
    width: 20px;
    height: 20px;
}

.alerta-conteudo {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.alerta-conteudo strong {
    color: var(--sigem-gray-800);
}

.alerta-badge {
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
}

.alertas-vazio {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    text-align: center;
}

.alertas-vazio h3 {
    margin: 1rem 0 0.5rem;
    color: var(--sigem-gray-700);
}

/* Indicadores */
.indicadores-lista {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.indicador-item {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.indicador-label {
    width: 140px;
    font-size: 0.85rem;
    color: var(--sigem-gray-600);
}

.indicador-bar-container {
    flex: 1;
    height: 8px;
    background: var(--sigem-gray-200);
    border-radius: 4px;
    overflow: hidden;
}

.indicador-bar {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s ease;
}

.indicador-ideal { background: #22c55e; }
.indicador-medio { background: #eab308; }
.indicador-alto { background: #f97316; }
.indicador-baixo { background: #ef4444; }

.indicador-valor {
    width: 50px;
    text-align: right;
    font-weight: 600;
    font-size: 0.9rem;
}

/* M√©tricas Grid */
.metricas-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.metrica-item {
    text-align: center;
    padding: 1rem;
    background: var(--sigem-gray-50);
    border-radius: var(--radius-sm);
}

.metrica-valor {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--sigem-red);
}

.metrica-label {
    display: block;
    font-size: 0.75rem;
    color: var(--sigem-gray-500);
    margin-top: 0.25rem;
}

/* Complexidade Bars */
.complexidade-bars {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.complexidade-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.complexidade-label {
    width: 50px;
    font-size: 0.8rem;
    color: var(--sigem-gray-600);
}

.complexidade-bar-bg {
    flex: 1;
    height: 16px;
    background: var(--sigem-gray-100);
    border-radius: 8px;
    overflow: hidden;
}

.complexidade-bar {
    height: 100%;
    border-radius: 8px;
}

.complexidade-bar.baixa { background: #22c55e; }
.complexidade-bar.media { background: #eab308; }
.complexidade-bar.alta { background: #ef4444; }

.complexidade-valor {
    width: 40px;
    text-align: right;
    font-weight: 600;
    font-size: 0.85rem;
}

/* Responsivo */
@media (max-width: 1024px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .kpi-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .dashboard-tabs {
        flex-wrap: wrap;
    }
    
    .tab-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
    }
    
    .metricas-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<!-- ============================================================
     SCRIPTS DOS GR√ÅFICOS
     ============================================================ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // ============================================================
    // NAVEGA√á√ÉO DAS ABAS
    // ============================================================
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const tabId = btn.dataset.tab;
            
            // Remover active de todos
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            // Adicionar active no selecionado
            btn.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        });
    });
    
    // ============================================================
    // GR√ÅFICO: EVOLU√á√ÉO MENSAL
    // ============================================================
    const ctxEvolucao = document.getElementById('chartEvolucao');
    if (ctxEvolucao) {
        new Chart(ctxEvolucao, {
            type: 'line',
            data: {
                labels: {{ evolucao_labels|safe }},
                datasets: [
                    {
                        label: 'Criadas',
                        data: {{ evolucao_criadas|safe }},
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Em Andamento',
                        data: {{ evolucao_andamento|safe }},
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Conclu√≠das',
                        data: {{ evolucao_concluidas|safe }},
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    }
    
    // ============================================================
    // GR√ÅFICO: MISS√ïES POR TIPO (DONUT)
    // ============================================================
    const ctxTipo = document.getElementById('chartTipo');
    if (ctxTipo) {
        new Chart(ctxTipo, {
            type: 'doughnut',
            data: {
                labels: {{ tipo_labels|safe }},
                datasets: [{
                    data: {{ tipo_valores|safe }},
                    backgroundColor: [
                        '#ef4444',
                        '#f97316',
                        '#eab308',
                        '#22c55e',
                        '#3b82f6',
                        '#8b5cf6'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                },
                cutout: '60%'
            }
        });
    }
    
    // ============================================================
    // GR√ÅFICO: CARGA POR OBM (BARRAS HORIZONTAIS EMPILHADAS)
    // ============================================================
    const ctxOBM = document.getElementById('chartOBM');
    if (ctxOBM) {
        new Chart(ctxOBM, {
            type: 'bar',
            data: {
                labels: {{ obm_labels|safe }},
                datasets: [
                    {
                        label: 'Baixa',
                        data: {{ obm_baixa|safe }},
                        backgroundColor: '#22c55e'
                    },
                    {
                        label: 'M√©dia',
                        data: {{ obm_media|safe }},
                        backgroundColor: '#eab308'
                    },
                    {
                        label: 'Alta',
                        data: {{ obm_alta|safe }},
                        backgroundColor: '#ef4444'
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                        beginAtZero: true
                    },
                    y: {
                        stacked: true
                    }
                }
            }
        });
    }
    
    // ============================================================
    // GR√ÅFICO: DISTRIBUI√á√ÉO POR POSTO
    // ============================================================
    const ctxPosto = document.getElementById('chartPosto');
    if (ctxPosto) {
        new Chart(ctxPosto, {
            type: 'bar',
            data: {
                labels: {{ posto_labels|safe }},
                datasets: [
                    {
                        label: 'Efetivo',
                        data: {{ posto_efetivo|safe }},
                        backgroundColor: '#3b82f6'
                    },
                    {
                        label: 'Em Miss√£o',
                        data: {{ posto_em_missao|safe }},
                        backgroundColor: '#8b0000'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
    
    // ============================================================
    // GR√ÅFICO: DISTRIBUI√á√ÉO POR QUADRO (DONUT)
    // ============================================================
    const ctxQuadro = document.getElementById('chartQuadro');
    if (ctxQuadro) {
        new Chart(ctxQuadro, {
            type: 'doughnut',
            data: {
                labels: {{ quadro_labels|safe }},
                datasets: [{
                    data: {{ quadro_valores|safe }},
                    backgroundColor: [
                        '#8b0000',
                        '#dc2626',
                        '#f97316',
                        '#eab308',
                        '#22c55e'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                },
                cutout: '60%'
            }
        });
    }
    
    // Reinicializar √≠cones Lucide
    lucide.createIcons();
});
</script>

<!-- CSS para Tooltips de Informa√ß√£o -->
<style>
/* Bot√£o de Informa√ß√£o */
.info-btn {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: #e5e7eb;
    border: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
    transition: all 0.2s ease;
    position: relative;
}

.info-btn:hover {
    background: #d1d5db;
}

.info-btn i {
    width: 14px;
    height: 14px;
    color: #6b7280;
}

.info-btn.active {
    background: #8b0000;
}

.info-btn.active i {
    color: white;
}

/* Container do Card Header com Info */
.card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.card-header .card-title {
    flex: 1;
}

/* Tooltip/Bal√£o de Informa√ß√£o */
.info-tooltip {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 8px;
    width: 300px;
    background: #1f2937;
    color: white;
    padding: 1rem;
    border-radius: 8px;
    font-size: 0.85rem;
    line-height: 1.5;
    z-index: 1000;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.info-tooltip::before {
    content: '';
    position: absolute;
    top: -6px;
    right: 12px;
    width: 12px;
    height: 12px;
    background: #1f2937;
    transform: rotate(45deg);
}

.info-tooltip.show {
    display: block;
    animation: fadeInTooltip 0.2s ease;
}

@keyframes fadeInTooltip {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.info-tooltip-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #f3f4f6;
    font-size: 0.9rem;
}

.info-tooltip-text {
    color: #d1d5db;
    margin-bottom: 0.5rem;
}

.info-tooltip-calc {
    background: rgba(255,255,255,0.1);
    padding: 0.5rem;
    border-radius: 4px;
    font-family: monospace;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}

.info-tooltip-meta {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid rgba(255,255,255,0.1);
}

/* Container relativo para posicionamento */
.info-container {
    position: relative;
    display: inline-flex;
}

/* KPI Info Button */
.kpi-card {
    position: relative;
}

.kpi-info-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: rgba(0,0,0,0.05);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    opacity: 0.5;
}

.kpi-card:hover .kpi-info-btn {
    opacity: 1;
}

.kpi-info-btn:hover {
    background: rgba(0,0,0,0.1);
}

.kpi-info-btn i {
    width: 12px;
    height: 12px;
    color: #6b7280;
}

.kpi-info-btn.active {
    background: #8b0000;
    opacity: 1;
}

.kpi-info-btn.active i {
    color: white;
}

.kpi-tooltip {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 4px;
    width: 260px;
    background: #1f2937;
    color: white;
    padding: 0.75rem;
    border-radius: 8px;
    font-size: 0.8rem;
    line-height: 1.4;
    z-index: 1000;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    display: none;
}

.kpi-tooltip.show {
    display: block;
    animation: fadeInTooltip 0.2s ease;
}

.kpi-tooltip::before {
    content: '';
    position: absolute;
    top: -6px;
    right: 10px;
    width: 10px;
    height: 10px;
    background: #1f2937;
    transform: rotate(45deg);
}
</style>

<!-- JavaScript para Tooltips -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fechar todos os tooltips ao clicar fora
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.info-btn') && !e.target.closest('.info-tooltip') &&
            !e.target.closest('.kpi-info-btn') && !e.target.closest('.kpi-tooltip')) {
            document.querySelectorAll('.info-tooltip.show, .kpi-tooltip.show').forEach(t => t.classList.remove('show'));
            document.querySelectorAll('.info-btn.active, .kpi-info-btn.active').forEach(b => b.classList.remove('active'));
        }
    });
    
    // Toggle tooltip ao clicar no bot√£o
    document.querySelectorAll('.info-btn, .kpi-info-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            
            const tooltip = this.nextElementSibling;
            const isActive = this.classList.contains('active');
            
            // Fechar todos os outros
            document.querySelectorAll('.info-tooltip.show, .kpi-tooltip.show').forEach(t => t.classList.remove('show'));
            document.querySelectorAll('.info-btn.active, .kpi-info-btn.active').forEach(b => b.classList.remove('active'));
            
            // Toggle atual
            if (!isActive) {
                this.classList.add('active');
                tooltip.classList.add('show');
            }
        });
    });
});
</script>

{% endblock %}
